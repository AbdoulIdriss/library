<section class="max-w-6xl mx-auto px-4 py-6">
  <h2 class="text-2xl font-bold text-gray-900">Administrator</h2>

  <div class="mt-6 grid gap-6 md:grid-cols-2">
    <div class="rounded-xl border border-black/10 bg-white p-4">
      <h3 class="text-lg font-semibold">Add / Edit Book</h3>
      <form class="mt-3 grid gap-3" (ngSubmit)="saveBook()">
        <input class="rounded-lg border border-gray-300 px-3 py-2" type="text" [(ngModel)]="form.title" name="title" placeholder="Title" required />
        <input class="rounded-lg border border-gray-300 px-3 py-2" type="text" [(ngModel)]="form.author" name="author" placeholder="Author" required />
        <input class="rounded-lg border border-gray-300 px-3 py-2" type="text" [(ngModel)]="form.genre" name="genre" placeholder="Genre" />
        <input class="rounded-lg border border-gray-300 px-3 py-2" type="text" [(ngModel)]="form.isbn" name="isbn" placeholder="ISBN (13)" />
        <input class="rounded-lg border border-gray-300 px-3 py-2" type="url" [(ngModel)]="form.coverUrl" name="coverUrl" placeholder="Cover URL" />
        <textarea class="rounded-lg border border-gray-300 px-3 py-2" rows="3" [(ngModel)]="form.summary" name="summary" placeholder="Summary"></textarea>
        <input class="rounded-lg border border-gray-300 px-3 py-2" type="number" min="0" [(ngModel)]="form.totalCopies" name="totalCopies" placeholder="Total copies" />
        <div class="flex gap-2 justify-end">
          <button class="rounded-md border border-gray-300 px-3 py-2" type="button" (click)="resetForm()">Clear</button>
          <button class="rounded-md bg-purple-600 text-white px-3 py-2" type="submit">Save</button>
        </div>
      </form>
    </div>

    <div class="rounded-xl border border-black/10 bg-white p-4">
      <h3 class="text-lg font-semibold">Books</h3>
      <div class="mt-3 grid gap-2">
        @for (b of books(); track b.id) {
          <div class="rounded-lg border border-gray-200 p-3 flex items-center gap-3">
            <img [src]="b.coverUrl" [alt]="b.title" class="h-16 w-12 object-cover rounded" />
            <div class="flex-1">
              <div class="font-semibold">{{ b.title }}</div>
              <div class="text-sm text-gray-600">{{ b.author }}</div>
              <div class="text-xs text-gray-500">ISBN {{ b.isbn }}</div>
            </div>
            <div class="flex items-center gap-2">
              <input class="w-20 rounded border border-gray-300 px-2 py-1 text-sm" type="number" min="0" [ngModel]="b.availableCopies" (ngModelChange)="setAvailable(b.id, $event)" />
              <button class="rounded-md border border-gray-300 px-3 py-1 text-sm" (click)="edit(b)">Edit</button>
              <button class="rounded-md bg-red-600 text-white px-3 py-1 text-sm" (click)="remove(b.id)">Delete</button>
            </div>
          </div>
        } @empty {
          <p class="text-gray-600">No books yet.</p>
        }
      </div>
    </div>
  </div>

  <div class="mt-8 grid gap-6 md:grid-cols-2">
    <div class="rounded-xl border border-black/10 bg-white p-4">
      <h3 class="text-lg font-semibold">All Loans</h3>
      <div class="mt-3 space-y-3 max-h-96 overflow-auto">
        @for (l of allLoans(); track l.id) {
          <div class="flex items-center gap-3 border rounded-lg p-3">
            <img *ngIf="l.book?.coverUrl" [src]="l.book?.coverUrl" [alt]="l.book?.title" class="h-14 w-10 object-cover rounded" />
            <div class="flex-1">
              <div class="font-medium">{{ l.book?.title || l.bookId }}</div>
              <div class="text-xs text-gray-600">Loan: {{ l.loanDate | date:'shortDate' }} â€¢ Due: {{ l.dueDate | date:'shortDate' }}</div>
              <div class="text-xs text-gray-500">Borrower: {{ l.user?.name }} ({{ l.user?.email }})</div>
              <div class="text-xs" [class.text-red-600]="isOverdueLoan(l)">
                {{ l.returnDate ? ('Returned: ' + (l.returnDate | date:'shortDate')) : 'Active' }}
              </div>
            </div>
            <button class="rounded-md border px-3 py-1 text-sm" (click)="forceReturn(l.id)" [disabled]="!!l.returnDate">Force return</button>
          </div>
        } @empty {
          <p class="text-gray-600">No loans.</p>
        }
      </div>
    </div>

    <div class="rounded-xl border border-black/10 bg-white p-4">
      <h3 class="text-lg font-semibold">All Reservations</h3>
      <div class="mt-3 space-y-3 max-h-96 overflow-auto">
        @for (r of allReservations(); track r.id) {
          <div class="flex items-center gap-3 border rounded-lg p-3">
            <img *ngIf="r.book?.coverUrl" [src]="r.book?.coverUrl" [alt]="r.book?.title" class="h-14 w-10 object-cover rounded" />
            <div class="flex-1">
              <div class="font-medium">{{ r.book?.title || r.bookId }}</div>
              <div class="text-xs text-gray-600">Status: {{ r.status }}</div>
              <div class="text-xs text-gray-600">Created: {{ r.createdAt | date:'short' }}</div>
              <div class="text-xs text-gray-500">User: {{ r.user?.name }} ({{ r.user?.email }})</div>
            </div>
            <div class="flex gap-2">
              <button class="rounded-md border px-3 py-1 text-sm" (click)="markReservationAvailable(r.id)" [disabled]="r.status === 'NOTIFIED'">Mark available</button>
              <button class="rounded-md bg-red-600 text-white px-3 py-1 text-sm" (click)="cancelReservation(r.id)">Cancel</button>
            </div>
          </div>
        } @empty {
          <p class="text-gray-600">No reservations.</p>
        }
      </div>
    </div>
  </div>
</section>

